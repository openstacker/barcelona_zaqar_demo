auto_healing:
  description: Workflow for auto heal stack triggered by Zaqar notification
  input:
  - server_id_map: {4imti4zsjudh: 756f3f42-ace1-45f3-8b48-4ec691da2eda, p2yh5yggzhfs: 4e273d26-60fa-4fd2-b1c7-414bcfd74a41}
  - server_name_map: {4imti4zsjudh: au-ing-servers-eksurizar3pk-4imti4zsjudh-fxxtlk4i5lsj,
      p2yh5yggzhfs: au-ing-servers-eksurizar3pk-p2yh5yggzhfs-5grufrp3u6ag}
  - {stack_id: 97c5a131-88f2-4f51-ad7a-9721e5e8ba09}
  - {root_stack_id: 6d2040ac-8b34-40ec-992d-e7a517160e26}
  - body
  - queue_name
  - Message_Type
  - ttl
  tasks:
    resources_mark_unhealthy:
      action: heat.resources_mark_unhealthy stack_id=<% $.stack_id %> resource_name=<%
        dict($.server_id_map.items().select([$[1],$[0]]))[$.body.reason_data.event.traits.where($[0]
        = 'instance_id').select($[2]).first()] %> mark_unhealthy=true resource_status_reason='Marked
        by alarm'
      on-success: [stacks_update]
    stacks_update: {action: heat.stacks_update stack_id=<% $.root_stack_id %> existing=true}
  type: direct
version: '2.0'
