auto_healing:
  description: Workflow for auto heal stack triggered by Zaqar notification
  input:
  - server_id_map: {cwiqtiku4mqn: d14ff821-2e41-4cad-abbd-99f30fc477a2, hdzrzdf5femq: ad5617e3-4c5f-49a6-ab7f-09e8904a4e16}
  - server_name_map: {cwiqtiku4mqn: au-ing-servers-wxl2qer6o3ju-cwiqtiku4mqn-dxzwrbvgusbt,
      hdzrzdf5femq: au-ing-servers-wxl2qer6o3ju-hdzrzdf5femq-5gry742amap5}
  - {stack_id: dd3a18f9-3b46-4cd3-9b07-3c8e977e8437}
  - {root_stack_id: 9bde2ca7-2dd3-4b55-9a07-5e9710dbc6c9}
  - body
  - queue_name
  - Message_Type
  - ttl
  tasks:
    resources_mark_unhealthy:
      action: heat.resources_mark_unhealthy stack_id=<% $.stack_id %> resource_name=<%
        dict($.server_id_map.items().select([$[1],$[0]]))[$.body.reason_data.event.traits.where($[0]
        = 'instance_id').select($[2]).first()] %> mark_unhealthy=true resource_status_reason='Marked
        by alarm'
      on-success: [stacks_update]
    stacks_update: {action: heat.stacks_update stack_id=<% $.root_stack_id %> existing=true}
  type: direct
version: '2.0'
