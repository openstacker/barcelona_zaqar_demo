auto_healing:
  description: Workflow for auto heal stack triggered by Zaqar notification
  input:
  - server_id_map: {dcu7sa65dm22: 567b0147-41e3-4987-be2c-05f8b76068f9, otkgth4y3pl6: 2051000d-9a2a-49ac-ba3f-36829b881d99}
  - server_name_map: {dcu7sa65dm22: au-ing-servers-ekqwp3emrjrg-dcu7sa65dm22-immkgerxztmc,
      otkgth4y3pl6: au-ing-servers-ekqwp3emrjrg-otkgth4y3pl6-33idw6sw7vm4}
  - {stack_id: 0396adc9-54ad-4700-acbb-ebb57ed6164f}
  - {root_stack_id: 74bba387-e5d9-4f6a-97a5-30a0cc1c0b14}
  - body
  - queue_name
  - Message_Type
  - ttl
  tasks:
    resources_mark_unhealthy:
      action: heat.resources_mark_unhealthy stack_id=<% $.stack_id %> resource_name=<%
        dict($.server_id_map.items().select([$[1],$[0]]))[$.body.reason_data.event.traits.where($[0]
        = 'instance_id').select($[2]).first()] %> mark_unhealthy=true resource_status_reason='Marked
        by alarm'
      on-success: [stacks_update]
    stacks_update: {action: heat.stacks_update stack_id=<% $.root_stack_id %> existing=true}
  type: direct
version: '2.0'
